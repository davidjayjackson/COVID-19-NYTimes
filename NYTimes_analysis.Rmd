---
title: "NY Times COVID-19 Analysis"
author: "David J Jackson"
date: "3/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(RSQLite)
library(plotly)
```

## NY Times US States Data Analysis
* GitHub: https://github.com/nytimes/covid-19-data.git

```{r}
rm(list=ls())
us_states <- read_csv("./DATA/us-states.csv")

states_LTC <- us_states %>% filter(cases <=344)
states_GTC <- us_states %>% filter(cases >=344)
states_LTD <- us_states %>% filter(deaths <=15.5)
tates_GTD <- us_states %>% filter(deaths >=15.5)

us_counties <- read_csv("./DATA/us-counties.csv")

counties_LTC <- us_counties %>% filter(cases <=30.18)
countries_GTC <- us_counties %>% filter(cases >=30.18)
states_LTD <- us_counties %>% filter(deaths <=4)
states_GTD <- us_counties %>% filter(deaths >=4)


db <- dbConnect(SQLite(), dbname="../db/CORVID.sqlite3")
us_states$date <- as.character(us_states$date)
dbWriteTable(db, "us_states",us_states ,overwrite=TRUE)

us_counties$date <- as.character(us_counties$date)
dbWriteTable(db, "us_counties",us_counties ,overwrite=TRUE)
dbListTables(db)

```

#### Summary of US States Total cases and Deaths


```{r}
states_LTC %>% ggplot() + geom_col(aes(x=reorder(state,cases),y=cases)) +
  coord_flip() +
  labs(title="Summary Cases by State",subtitle="(Number of cases <=344)")

states_GTC %>% ggplot() + geom_col(aes(x=state,y=deaths)) +
  labs(title="Summary of Deaths  by State",subtitle="(Number of cases >=344)") + coord_flip() 
```

```{r}
us_states %>% ggplot() + geom_col(aes(x=date,y=cases,col=state)) +
  labs(title="Daily Cases Summary by Date")

us_states %>% ggplot() + geom_line(aes(x=date,y=cases,col=state)) +
  labs(title="Daily Cases Summary by State")
```

#### Summary of States  Cases and Deaths

```{r}
us_states %>% ggplot() + geom_line(aes(x=date,y=cases,col=state)) +
  labs(title="Daily Cases Summary by Date")

us_states %>% ggplot() + geom_line(aes(x=date,y=deaths,col=state)) +
  labs(title="Daily Deaths Summary by State")
```
```{r}
us_states %>% plot_ly() %>% add_lines(x=~date,y=~cases)
```

#### Summary of Ohio Deaths and Cases

```{r}

ohio_counties <- us_counties %>% filter(state=="Ohio")
ohio_counties %>% ggplot() + geom_col(aes(x=date,y=cases)) +
  labs(title="Ohio Daily Cases Summary by Date")

ohio_counties %>% ggplot() + geom_col(aes(x=date,y=deaths)) +
  labs(title="Ohio Daily Deaths Summary by Date")


ohio_counties %>% ggplot() + geom_col(aes(x=date,y=cases,col=county)) +
  labs(title="Ohio/county Daily Cases Summary by Date")

ohio_counties %>% ggplot() + geom_line(aes(x=date,y=deaths,col=county)) +
  labs(title="Ohio/County Daily Deaths Summary by State")
```
```{r}
us_states %>% ggplot() + geom_point(aes(x=cases,y=deaths)) +
  geom_smooth(aes(x=cases,y=deaths))
```
```{r}
dbDisconnect(db)
```

