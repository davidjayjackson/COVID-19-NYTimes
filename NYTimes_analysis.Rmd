---
title: "NY Times US States COVID-19 Analysis"
author: "David J Jackson"
date: "3/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=9, fig.height=6)
library(tidyverse)
library(RSQLite)
library(plotly)
```

## NY Times US States Data Analysis
* GitHub: https://github.com/nytimes/covid-19-data.git


```{r, echo=FALSE}
rm(list=ls())
us_states <- read_csv("./DATA/us-states.csv")

us_total <- us_states %>% group_by(date) %>% summarise(Cases=sum(cases),                                                        Deaths = sum(deaths),                                                     DeathRate = Cases/Deaths)

us_state_total <- us_states %>% group_by(state,date) %>% summarise(Cases=sum(cases),                                                        Deaths = sum(deaths),                                                     DeathRate = Cases/Deaths)

```
```{r,echo=FALSE}
us_counties <- read_csv("./DATA/us-counties.csv")
us_county_summary <- us_counties %>% group_by(state,county,date) %>% summarise(Cases=sum(cases),                                                        Deaths = sum(deaths),DeathRate = Cases/Deaths)

```
```{r,echo=FALSE}
db <- dbConnect(SQLite(), dbname="../db/CORVID.sqlite3")
us_states$date <- as.character(us_states$date)
dbWriteTable(db, "us_states",us_states ,overwrite=TRUE)

us_counties$date <- as.character(us_counties$date)
dbWriteTable(db, "us_counties",us_counties ,overwrite=TRUE)
dbListTables(db)
dbDisconnect(db)

```

#### Summary of Cases and Deaths by Date

```{r,echo=FALSE}
us_total %>% plot_ly() %>% add_lines(x=~date,y=~Cases) %>%
  layout(title="US Daily Summary of Cases")

us_total %>% plot_ly() %>% add_lines(x=~date,y=~Deaths) %>%
  layout(title="US Daily Summary of Deaths")

us_total %>% plot_ly() %>% add_lines(x=~date,y=~DeathRate) %>%
  layout(title="US Daily Rate of Death")
```

#### Summary of Cases and Deaths by State

```{r,echo=FALSE}
us_state_total %>% ggplot() + geom_col(aes(x=date,y=Cases,fill=state)) +
  labs(title="Daily Cases Summary by Date") 

us_state_total %>% ggplot() + geom_col(aes(x=date,y=Deaths,fill=state)) +
  labs(title="Daily Deaths Summary by State") 


```

#### Summary of Ohio Deaths and Cases

```{r,echo=FALSE}

ohio_counties <- us_county_summary %>% filter(state=="Ohio")
ohio_counties %>% ggplot() + geom_col(aes(x=date,y=Cases)) +
  labs(title="Ohio Daily Cases Summary by Date")

ohio_counties %>% ggplot() + geom_col(aes(x=date,y=Deaths)) +
  labs(title="Ohio Daily Deaths Summary by Date")

```
```{r,echo=FALSE}
ohio_counties %>% ggplot() + geom_col(aes(x=date,y=Cases,fill=county)) +
  labs(title="Ohio/county Daily Cases Summary by Date")

ohio_counties %>% ggplot() + geom_col(aes(x=date,y=Deaths,fill=county)) +
  labs(title="Ohio/County Daily Deaths Summary by C")
```
